syntax = "proto3";

package api.dex;

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/any.proto";
import "public/response/response.proto";
import "validate/validate.proto";
import "dex/user.proto";
import "dex/common.proto";
import "dex/wallet.proto";
import "dex/market.proto";
import "dex/trade.proto";

option go_package = "store/api/dex;dexpb";

service TradeService {
  rpc Trade (TradeParams) returns (api.dex.Trade) {
    option (google.api.http) = {
      post: "/api/tgbot/users/me/trades"
      body:  "*"
    };
  }
  rpc ListTrades (ListTradesParams) returns (api.dex.TradeList) {
    option (google.api.http) = {
      get: "/api/tgbot/users/me/trades"
    };
  };
  // ----------------------------- http -------------------------------
  rpc GetOrderSettings (GetOrderSettingsParams) returns (api.dex.TradeSettings) {
    option (google.api.http) = {
      get: "/api/tgbot/users/me/order-settings"
    };
  }
  rpc UpdateOrderSettings  (api.dex.TradeSettings) returns (api.dex.TradeSettings) {
    option (google.api.http) = {
      put: "/api/tgbot/users/me/order-settings"
      body: "*"
    };
  }

  rpc CreateLimitOrder (CreateLimitOrderParams) returns (api.dex.Order) {
    option (google.api.http) = {
      post: "/api/tgbot/users/me/limit-orders"
      body:  "*"
    };
  }
  rpc CancelLimitOrder (CancelLimitOrderParams) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete: "/api/tgbot/users/me/limit-orders/{id}"
    };
  }
  rpc ListUserOrders (ListUserOrdersParams) returns (api.dex.OrderList) {
    option (google.api.http) = {
      get: "/api/tgbot/users/me/orders"
    };
  }
  rpc GetUserOrderSummary (GetUserOrderSummaryParams) returns (OrderSummary) {
    option (google.api.http) = {
      get: "/api/tgbot/users/me/order-summary"
    };
  }

  // ----------------------------- grpc -------------------------------
  //  rpc CompleteOrdersByPrice (CompleteOrdersByPriceParams) returns (google.protobuf.Empty) {}
  rpc ListOrders (ListOrdersParams) returns (api.dex.OrderList) {}
  rpc RunTask(RunTradeTaskParams) returns (google.protobuf.Empty) {}
}

message RunTradeTaskParams {
  string task = 1;
  map<string, string> params = 2;
}


message ListTradesParams {

  api.dex.CommonParams common = 20;
}

message TradeParams {
  string token = 1;
  // token amount | token amount rate |  sol amount
  double amount = 2;
  string side = 3;
  string category = 4;
  //  api.dex.Order following = 5;
  api.dex.TradeSettings settings = 6;
  string uniqueKey = 7;
  string trigger = 8;

  api.dex.CommonParams common = 20;
}

message ListOrdersParams {
  string category = 1;
  repeated string status = 2;
  string userId = 3;
  string tokenId = 4;

  int64 page = 20;
  int64 size = 21;
}

message CompleteOrdersByPriceParams {
}


message CancelLimitOrderParams {
  string id = 1;
}

message GetUserOrderSummaryParams {

}

message OrderSummary {
  int64 openOrderCount = 1;
  int64 ordersCount = 2;
}

message ListUserOrdersParams {
  string category = 1;
  bool hideFailedOrder = 2;

  api.dex.CommonParams common = 20;
}

message CreateLimitOrderParams {
  string token = 1;
  // 代币的amount
  double amount = 2;
  double amountRate = 5;
  string side = 3;
  double priceUSD = 4;
  api.dex.TradeSettings settings = 6;


  api.dex.CommonParams common = 20;

}

message GetOrderSettingsParams {
  api.dex.CommonParams common = 20;
}

message UpdateOrderSettingsParams {
}

message CreateOrderParams {
  string token = 1;
  // token amount | token amount rate |  sol amount
  double amount = 2;
  string side = 3;
  string category = 4;
  api.dex.Order following = 5;
  api.dex.TradeSettings settings = 6;
  string uniqueKey = 7;
  string trigger = 8;

  api.dex.CommonParams common = 20;
}
